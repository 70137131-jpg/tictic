<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TicTacToe RL Agent</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background: #FFE951;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      background: #FFF;
      padding: 40px;
      border: 6px solid #000;
      box-shadow: 12px 12px 0 #000;
      max-width: 550px;
      text-align: center;
    }
    h3 { font-size: 36px; margin: 0 0 20px 0; }
    #board { border-collapse: separate; border-spacing: 8px; margin: 30px auto; }
    #board td {
      width: 100px; height: 100px;
      font-size: 48px; font-weight: bold;
      border: 5px solid #000;
      background: #FFF;
      cursor: pointer;
      text-align: center;
      box-shadow: 4px 4px 0 #000;
    }
    #board td:hover { transform: translate(-2px, -2px); box-shadow: 6px 6px 0 #000; }
    #board td.X { background: #FF6B6B; }
    #board td.O { background: #4ECDC4; }
    button {
      padding: 15px 30px;
      font-size: 18px;
      font-weight: bold;
      border: 5px solid #000;
      background: #4ECDC4;
      cursor: pointer;
      margin: 10px;
      box-shadow: 6px 6px 0 #000;
    }
    button:hover { transform: translate(-2px, -2px); box-shadow: 8px 8px 0 #000; }
    #status {
      margin-top: 20px;
      padding: 20px;
      font-size: 18px;
      border: 5px solid #000;
      background: #FFF;
      box-shadow: 6px 6px 0 #000;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h3>Tic-Tac-Toe AI</h3>
    <p>You are <strong>X</strong>, AI is <strong>O</strong></p>
    
    <table id="board">
      <tr><td data-pos="0,0">-</td><td data-pos="0,1">-</td><td data-pos="0,2">-</td></tr>
      <tr><td data-pos="1,0">-</td><td data-pos="1,1">-</td><td data-pos="1,2">-</td></tr>
      <tr><td data-pos="2,0">-</td><td data-pos="2,1">-</td><td data-pos="2,2">-</td></tr>
    </table>
    
    <button id="reset">Reset Game</button>
    <div id="status">Click a cell to start!</div>
  </div>

  <script>
    const board = document.getElementById('board');
    const status = document.getElementById('status');
    const resetBtn = document.getElementById('reset');
    let gameActive = true;

    function readBoard() {
      const b = [];
      document.querySelectorAll('#board tr').forEach(tr => {
        const row = [];
        tr.querySelectorAll('td').forEach(td => row.push(td.textContent.trim()));
        b.push(row);
      });
      return b;
    }

    function writeBoard(b) {
      document.querySelectorAll('#board td').forEach(td => {
        const [r,c] = td.dataset.pos.split(',').map(Number);
        td.textContent = b[r][c];
        td.className = b[r][c] !== '-' ? b[r][c] : '';
      });
    }

    function checkWinner(b) {
      const lines = [
        [[0,0],[0,1],[0,2]], [[1,0],[1,1],[1,2]], [[2,0],[2,1],[2,2]],
        [[0,0],[1,0],[2,0]], [[0,1],[1,1],[2,1]], [[0,2],[1,2],[2,2]],
        [[0,0],[1,1],[2,2]], [[0,2],[1,1],[2,0]]
      ];
      for (const line of lines) {
        const [a,b,c] = line;
        const v1 = b[a[0]][a[1]], v2 = b[b[0]][b[1]], v3 = b[c[0]][c[1]];
        if (v1 !== '-' && v1 === v2 && v2 === v3) return v1;
      }
      if (b.every(row => row.every(cell => cell !== '-'))) return 'Draw';
      return null;
    }

    async function handleMove(r, c) {
      if (!gameActive) return;
      const b = readBoard();
      if (b[r][c] !== '-') return;
      
      b[r][c] = 'X';
      writeBoard(b);
      
      let result = checkWinner(b);
      if (result) { endGame(result); return; }
      
      status.textContent = 'ðŸ¤– AI thinking...';
      
      try {
        const res = await fetch('/api/move', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({board: b, difficulty: 'hard'})
        });
        const data = await res.json();
        const [i,j] = data.move;
        b[i][j] = 'O';
        writeBoard(b);
        
        result = checkWinner(b);
        if (result) { endGame(result); }
        else { status.textContent = `AI placed O at (${i},${j})`; }
      } catch(e) {
        status.textContent = 'âŒ Error: ' + e.message;
      }
    }

    function endGame(winner) {
      gameActive = false;
      if (winner === 'X') status.textContent = 'ðŸŽ‰ You Win!';
      else if (winner === 'O') status.textContent = 'ðŸ¤– AI Wins!';
      else status.textContent = "It's a Draw!";
    }

    function reset() {
      gameActive = true;
      writeBoard([['-','-','-'],['-','-','-'],['-','-','-']]);
      status.textContent = 'Click a cell to start!';
    }

    board.querySelectorAll('td').forEach(td => {
      td.addEventListener('click', () => {
        const [r,c] = td.dataset.pos.split(',').map(Number);
        handleMove(r, c);
      });
    });

    resetBtn.addEventListener('click', reset);
  </script>
</body>
</html>
